#include <stdlib.h>
#include <stdio.h>
#include <time.h>
#include <string.h>
#include <math.h>
#include <float.h>
#include <time.h>
#include "type.h"


int main(int argc, char* argv[])
{
	int ok;

	if (argc <= 2) {
		printf("Input files are missing: param.txt and results.txt\n");
		return 0;
	}

	if (argc > 2) {

		ok=InitNetwork(argv[1]);
		if (ok !=1) return 0;



        initFiles(argv[2]);
        if((Algorithm==1 || Algorithm ==2 || Algorithm ==3) && (exploit==3 || exploit==4 || exploit==5))
        {
            printf("This algorithm does not require exploration phase\n");
            return 0;
        }
        if(Algorithm > 3)
        {
            printf("exploration method does not exist\n");
            return 0;
        }
        if(exploit > 5)
        {
            printf("exploitation method does not exist\n");
            return 0;
        }
        for (dr=0;dr<Draws;dr++)

                 {srand(time(0));
                    if(Algorithm!=2)
                        initializeCollabExpl();
                    else initializeSelfishExpl();

                    if (Algorithm == 1 && exploit !=3 && exploit !=4 &&  exploit !=5) {
                        printf("***********Collaborative EXploration************\n",ok);ok=collaborativeAlgo(argv[2]);
                    }

                    if (Algorithm == 2 && exploit !=3 && exploit !=4 &&  exploit !=5) {
                        printf("***********Selfish exploration************\n",ok);ok=selfishEstimation(argv[2]);
                    }

                    if (Algorithm == 3 && exploit !=3 && exploit !=4 &&  exploit !=5) {
                        printf("***********scheduled forced exploration************\n",ok);ok=scheduledForced(argv[2]);
                    }

                    printf("\n***********TotalDuration[%d]=%d\n",dr ,duration[dr]);

                    if(exploit!=0)
                        StartExploit();


                    for(int j=0;j < Draws;j++)
                        printf("collisionRate[%d]=%f\n", j, collRate[j][0]);

                    for(int k=0;k<K;k++)
                        {int sum=0;
                            for(int n=0;n<N;n++)
                                sum=sum+Player[n].B[k].tk;
                            avg_arm[dr][k]=(float)avg_arm[dr][k]/(float)sum;
                            printf("arm[%d]=%d, avg[%d]=%f mu[%d]=%f, col[%d]=%f,los[%d]=%f, expectedcol=%f\n",k,sum,k,avg_arm[0][k],k,avg_arm[0][k]*sum/T,k,col_arm[0][k]/sum,k,los_arm[0][k]/sum, expectedCol(k));
                        }
                    printf("xmin=%f, xmax=%f\n",Xmin,Xmax);
                    for(int i=0;i<K;i++)
                            armsPlays[i]=0;
                }
                printf("before N\n");
                PlotCurve(argv[2]);
	}
	return 0;
}
