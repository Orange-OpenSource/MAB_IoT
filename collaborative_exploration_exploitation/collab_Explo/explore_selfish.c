#include <stdlib.h>
#include <stdio.h>
#include <time.h>
#include <string.h>
#include <math.h>
#include <float.h>
#include "type.h"

/**selfish exploration algorithm
*/
void selfishEstimation(char *nom_fichier)
{
        float samplesPerArm= (float) log(2/delta)/(2*pow(epsilon2,2));
        printf("total number of samples per arm=%f\n",samplesPerArm );
        printf("total number of required samples=%f\n",samplesPerArm*K );
        printf("samples with selfish is %f\n",samplesPerArm*K*N);
        int minpl=slowPl();
        printf("slowest player %d\n",minpl);

        int k,n,play,yes=0;
        float y;
        while(SelfishfinishEstimating()==0)
            {
             duration[dr]=duration[dr]+1;
             float x=RAND_R(1.0);
             for (n=0; n<N; n++)
                {
                //sending active rate or estimating
                play=isPlaying(n,x);
                if(play==1){Player[n].k=PlayRoundRobin(n);
                            k=Player[n].k;
                            plays[dr]=plays[dr]+1;
                            Player[n].B[k].tk=Player[n].B[k].tk+1;
                            Player[n].t=Player[n].t+1;
                            sampleComplexity[dr]=sampleComplexity[dr]+1;
                            if(n==0)printf("Player[%d].B[%d].tk=%d/%d\n",n,k,Player[n].B[k].tk,Player[n].T_k);
                    }

                if(play==0) Player[n].k=-1;
                }

            for (n=0; n<N; n++)
            {

                k=Player[n].k;
                //reward gained by player n
                if(Player[n].k!=-1) {
                    y=GetReward(k,n,dr);
                    playersRewards[n]=playersRewards[n]+y;
                    Rewards[dr]=Rewards[dr]+y;
                    if(y==1.0) Player[n].p=Player[n].pr;

                    Player[n].B[k].mu=(float)y/(float )Player[n].B[k].tk+(float)(Player[n].B[k].tk-1)/(float)Player[n].B[k].tk*Player[n].B[k].mu;
                    Player[n].B[k].mu=Player[n].B[k].mu;
                    }
            }
            }

            float sum=0.0;
            for(int l=0;l<K;l++)
                printf("arm[%d]=%f with %d plays\n",l,Player[0].B[l].mu/collisionRate(0),Player[0].B[l].tk);

            samples[dr]=plays[dr];

        for(int j=0;j<K;j++)
            {
                finalEstimation[j]=Player[N-1].B[j].mu;
                printf("estimation[%d]=%f(%f)\n",j,finalEstimation[j],Arm[j]);
            }

        mu_pi[dr][0]=(float)Rewards[dr]/duration[dr];
        average_mu[dr][0]=(float)Rewards[dr]/plays[dr];
        collRate[dr][0]=(float)collisions[dr]/plays[dr];

}









